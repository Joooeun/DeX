# Windmill 버그리포트 (fe4bf93 ~ 현재)

## 개요
커밋 fe4bf9337720850526acf0928670e4ef142c53d9부터 현재까지 발견되고 수정된 버그들을 정리한 보고서입니다.

## 수정된 버그 목록

### 1. 파라미터 초기화 버그 (커밋: b7ddce5)
- **날짜**: 2025-09-19
- **파일**: SQLTemplate.jsp
- **발생 상황**: 
  - 템플릿 로드 시 파라미터나 단축키 데이터가 없는 경우 빈 메시지가 표시되는 대신 컨테이너가 숨겨짐
  - 데이터가 있는 경우에만 컨테이너가 보이도록 수정
- **수정 내용**:
  - 데이터가 없을 때 컨테이너를 숨기는 로직 추가
  - 파라미터/단축키 렌더링 시 조건부 표시 로직 개선
  - 테이블 스타일에서 table-striped 클래스 제거
- **영향도**: 중간

### 2. 연결가능 DB Select2 버그 (커밋: adf5c3f)
- **날짜**: 2025-09-19
- **파일**: SQLTemplate.jsp
- **발생 상황**: 
  - Select2 컴포넌트에서 textField가 함수인 경우와 문자열인 경우를 구분하지 못함
  - 연결 가능한 DB 목록 표시 시 오류 발생
- **수정 내용**:
  - textField 타입 체크 로직 추가 (함수 vs 문자열)
  - Select2 CDN 링크 제거 (로컬 파일 사용)
- **영향도**: 중간

### 3. 템플릿 선택 시 저장 후 선택 해제 문제 (커밋: 42b668c)
- **날짜**: 2025-09-16
- **파일**: SQLTemplate.jsp
- **발생 상황**: 
  - 템플릿 선택 시 변경사항이 있으면 저장 확인 다이얼로그가 나타남
  - 저장 후 원래 선택하려던 템플릿이 선택되지 않고 해제됨
- **수정 내용**:
  - confirmUnsavedChanges에 콜백 파라미터 추가
  - 저장 완료 후 원래 동작(템플릿 선택)이 실행되도록 수정
  - 중복 코드 제거 및 공통 함수 생성
  - 사용하지 않는 함수 제거
  - 로딩 오버레이 및 토스트 메시지 시스템 추가
- **영향도**: 높음

### 4. 템플릿 수정 외래키 버그 (커밋: 8986509)
- **날짜**: 2025-09-16
- **파일**: SqlTemplateService.java, SQLTemplate.jsp
- **발생 상황**: 
  - 템플릿 수정 시 해당 템플릿을 대상으로 하는 단축키가 자동으로 삭제됨
  - 외래키 제약조건으로 인한 데이터 손실 발생
- **수정 내용**:
  - 템플릿 존재 여부 확인 로직 추가
  - UPDATE 방식과 INSERT 방식 분리
  - 기존 데이터 삭제 후 재생성하는 방식으로 변경
  - 단축키 업데이트 시 SOURCE_TEMPLATE_ID만 삭제하도록 수정
- **영향도**: 높음

### 5. 템플릿 로드 시 변경 감지 버그 (커밋: 9a5d2ca)
- **날짜**: 2025-09-16
- **파일**: SQLTemplate.jsp
- **발생 상황**: 
  - 템플릿 로드 시 변경 감지가 제대로 작동하지 않음
  - 로딩 상태와 변경 감지 상태가 충돌
- **수정 내용**:
  - 로딩 상태 중에는 변경 감지 비활성화
  - 렌더링 완료 후 변경사항 초기화 및 추적 재개
- **영향도**: 중간

### 6. 변경감지 버그 (커밋: 09632dd)
- **날짜**: 2025-09-16
- **파일**: SQLTemplate.jsp, sql-template.css
- **발생 상황**: 
  - 변경 감지 로직이 복잡하고 중복 코드가 많음
  - CSS가 JSP 파일에 인라인으로 포함되어 유지보수 어려움
- **수정 내용**:
  - 변경 감지 로직 단순화 및 최적화
  - CSS를 별도 파일(sql-template.css)로 분리
  - 중복 코드 제거 및 공통 함수 생성
- **영향도**: 높음

### 7. 빈 SQL 탭 삭제되는 버그 (커밋: 5bfc5b0)
- **날짜**: 2025-09-16
- **파일**: SQLTemplate.jsp
- **발생 상황**: 
  - SQL 내용이 비어있는 탭이 저장 시 자동으로 삭제됨
  - 사용자가 의도적으로 빈 탭을 유지하려는 경우 문제 발생
- **수정 내용**:
  - 빈 SQL 내용도 저장하도록 수정
  - sqlContent가 null이거나 빈 문자열인 경우에도 빈 문자열로 저장
- **영향도**: 중간

### 8. 탭 연결 변경시 반영 안되는 버그 (커밋: 22ab859)
- **날짜**: 2025-09-16
- **파일**: SQLTemplate.jsp
- **발생 상황**: 
  - 탭의 연결을 변경했을 때 변경사항이 UI에 반영되지 않음
  - 삭제된 연결에 대한 경고 표시가 없음
- **수정 내용**:
  - 연결 존재 여부 확인 로직 추가
  - 삭제된 연결에 대한 시각적 경고 표시
  - 탭 텍스트, 클래스, 버튼 속성 모두 업데이트
  - ACE 에디터 인스턴스도 함께 업데이트
- **영향도**: 높음

### 9. 결과테이블 높이 접기/펼치기 버그 (커밋: 265aef7)
- **날짜**: 2025-09-16
- **파일**: SQLExecute.jsp
- **발생 상황**: 
  - 결과테이블의 높이 접기/펼치기 기능이 제대로 작동하지 않음
  - 높이 조절 시 레이아웃이 깨짐
- **수정 내용**:
  - 높이 조절 로직 개선
  - 레이아웃 안정성 향상
- **영향도**: 중간

### 10. 템플릿 관리 SQL 추가버그 (커밋: 9dc9001)
- **날짜**: 2025-09-11
- **파일**: SQLTemplate.jsp, generate-test-report.sh
- **발생 상황**: 
  - 템플릿 관리에서 SQL 추가 시 발생하는 버그
  - 테스트 리포트 생성 스크립트 오류
- **수정 내용**:
  - SQL 추가 로직 수정
  - 테스트 리포트 생성 스크립트 개선
- **영향도**: 중간

### 11. 단축키 입력 버그 (커밋: 338beca)
- **날짜**: 2025-09-10
- **파일**: SQLTemplate.jsp
- **발생 상황**: 
  - 단축키 입력 필드가 readonly로 설정되어 있어 입력 불가
  - F1~F12 키 입력 시 자동으로 인식되지 않음
  - 단축키 필드명이 일관되지 않음 (key vs shortcutKey)
- **수정 내용**:
  - readonly 속성 제거
  - F1~F12 키 감지 이벤트 리스너 추가
  - 키 입력 시 자동으로 다음 필드로 포커스 이동
  - 필드명 통일 (shortcutKey, shortcutName, sourceColumnIndexes)
  - 콘솔 에러 메시지 제거
- **영향도**: 중간

### 12. 단축키 버그 (커밋: 79c9698)
- **날짜**: 2025-09-01
- **파일**: SQLController.java, SQLTemplateController.java, SQLExecuteService.java, SqlTemplateService.java, SQLExecute.jsp, SQLTemplate.jsp, common.jsp
- **발생 상황**: 
  - 단축키 기능 전반에서 다양한 버그 발생
  - 단축키 등록, 실행, 관리 기능의 불안정성
- **수정 내용**:
  - 단축키 관련 모든 로직 전면 수정
  - 서비스 계층과 컨트롤러 계층 개선
  - 프론트엔드 단축키 처리 로직 개선
- **영향도**: 높음

### 13. 연결정보 저장 오류 (커밋: f3933d7)
- **날짜**: 2025-08-14
- **파일**: ConnectionController.java, ConnectionService.java, DexStatusService.java, DynamicJdbcManager.java, Connection.jsp
- **발생 상황**: 
  - 연결정보 저장 시 CONNECTION_ID 필드 처리 오류
  - 에러 메시지에 상세 정보가 포함되지 않음
  - 스레드 종료 관련 로그 메시지 개선 필요
- **수정 내용**:
  - CONNECTION_ID 필드 처리 로직 수정
  - 에러 메시지에 상세 정보 추가
  - 스레드 종료 관련 로그 메시지 개선
  - 연결 테스트 기능 제거 (UI에서)
- **영향도**: 높음

### 14. 화면 버그 (커밋: 2579a7f)
- **날짜**: 2025-08-10
- **파일**: dashboard.jsp, TASK_CHECKLIST.md
- **발생 상황**: 
  - 대시보드 화면 표시 관련 버그
  - 작업 체크리스트 업데이트 필요
- **수정 내용**:
  - 대시보드 화면 표시 로직 수정
  - 작업 체크리스트 업데이트
- **영향도**: 낮음

## 버그 유형별 분류

### UI/UX 관련 버그
- 파라미터 초기화 버그
- 연결가능 DB Select2 버그
- 결과테이블 높이 접기/펼치기 버그
- 화면 버그

### 템플릿 관리 관련 버그
- 템플릿 선택 시 저장 후 선택 해제 문제
- 템플릿 수정 외래키 버그
- 템플릿 로드 시 변경 감지 버그
- 템플릿 관리 SQL 추가버그

### 탭 관리 관련 버그
- 빈 SQL 탭 삭제되는 버그
- 탭 연결 변경시 반영 안되는 버그

### 단축키 관련 버그
- 단축키 입력 버그
- 단축키 버그

### 데이터베이스 연결 관련 버그
- 연결정보 저장 오류

### 변경 감지 관련 버그
- 변경감지 버그

## 영향도 분석
- **높음**: 6개 (템플릿 선택/수정, 외래키, 변경감지, 탭 연결, 단축키, 연결정보)
- **중간**: 7개 (파라미터, Select2, 로드 감지, 빈탭, 결과테이블, SQL추가, 단축키입력)
- **낮음**: 1개 (화면)

## 화면 테스트 자동화를 위한 테스트 케이스

### 1. 파라미터 초기화 버그 테스트
**테스트 시나리오**: 템플릿 로드 시 파라미터/단축키 데이터 없음
- **전제 조건**: 파라미터나 단축키가 없는 템플릿 생성
- **실행 단계**:
  1. 템플릿 목록에서 해당 템플릿 선택
  2. 파라미터/단축키 섹션 확인
- **예상 결과**: 컨테이너가 숨겨짐 (display: none)
- **자동화 검증**: `$('#parameterTableBody').is(':visible') === false`

### 2. 연결가능 DB Select2 버그 테스트
**테스트 시나리오**: DB 연결 목록 표시
- **전제 조건**: 여러 DB 연결 설정됨
- **실행 단계**:
  1. 템플릿 편집 화면 진입
  2. "연결가능한 DB" 드롭다운 클릭
- **예상 결과**: DB 목록이 정상 표시됨
- **자동화 검증**: Select2 옵션 개수 > 0

### 3. 템플릿 선택 시 저장 후 선택 해제 문제 테스트
**테스트 시나리오**: 변경사항이 있는 상태에서 다른 템플릿 선택
- **전제 조건**: 
  - 템플릿 A 편집 중 (변경사항 있음)
  - 템플릿 B 존재
- **실행 단계**:
  1. 템플릿 A에서 내용 수정
  2. 템플릿 B 클릭
  3. 저장 확인 다이얼로그에서 "예" 선택
  4. 저장 완료 후 확인
- **예상 결과**: 템플릿 B가 선택된 상태로 표시
- **자동화 검증**: `$('.template-item.selected').data('id') === 'templateB'`

### 4. 템플릿 수정 외래키 버그 테스트
**테스트 시나리오**: 템플릿 수정 시 단축키 데이터 보존
- **전제 조건**: 
  - 템플릿에 단축키 설정됨
  - 다른 템플릿에서 해당 템플릿을 대상으로 하는 단축키 존재
- **실행 단계**:
  1. 템플릿 수정
  2. 저장
  3. 단축키 테이블 확인
- **예상 결과**: 기존 단축키 데이터 유지
- **자동화 검증**: 단축키 개수 변경 없음

### 5. 빈 SQL 탭 삭제되는 버그 테스트
**테스트 시나리오**: 빈 SQL 탭 저장
- **전제 조건**: SQL 내용이 비어있는 탭 존재
- **실행 단계**:
  1. 빈 SQL 탭에서 저장 버튼 클릭
  2. 저장 완료 후 탭 목록 확인
- **예상 결과**: 빈 탭이 유지됨
- **자동화 검증**: 탭 개수 유지, 빈 내용도 저장됨

### 6. 탭 연결 변경시 반영 안되는 버그 테스트
**테스트 시나리오**: 탭의 연결 정보 변경
- **전제 조건**: 
  - SQL 탭 존재
  - 다른 DB 연결 존재
- **실행 단계**:
  1. 탭 편집 버튼 클릭
  2. 연결 정보 변경
  3. 저장
  4. 탭 헤더 확인
- **예상 결과**: 탭 헤더에 새로운 연결명 표시
- **자동화 검증**: 탭 텍스트가 새로운 연결명과 일치

### 7. 단축키 입력 버그 테스트
**테스트 시나리오**: F1~F12 키 입력
- **전제 조건**: 단축키 추가 모드
- **실행 단계**:
  1. 단축키 추가 버튼 클릭
  2. 단축키 입력 필드에 F1 키 입력
- **예상 결과**: "F1" 자동 입력, 다음 필드로 포커스 이동
- **자동화 검증**: 
  - 입력 필드 값 === "F1"
  - 다음 필드가 포커스됨

## 화면 테스트 자동화 체크리스트

### UI 요소 존재 확인
- [ ] 파라미터 테이블 컨테이너
- [ ] 단축키 테이블 컨테이너  
- [ ] DB 연결 Select2 드롭다운
- [ ] 템플릿 목록
- [ ] SQL 탭 헤더
- [ ] 저장 확인 다이얼로그

### 데이터 상태 확인
- [ ] 템플릿 선택 상태
- [ ] 변경사항 추적 상태
- [ ] 로딩 상태
- [ ] 에러 메시지 표시

### 사용자 상호작용 테스트
- [ ] 클릭 이벤트
- [ ] 키보드 입력
- [ ] 드래그 앤 드롭
- [ ] 모달 다이얼로그

### 반응형 테스트
- [ ] 화면 크기별 레이아웃
- [ ] 모바일 환경
- [ ] 다양한 브라우저

## 화면 테스트 자동화 최종 결과 (2025-09-22)

### 📊 전체 테스트 실행 결과
- **총 테스트**: 28개
- **성공**: 18개 (64%)
- **실패**: 10개 (36%)
- **소요 시간**: 39분 15초

### ✅ 성공한 테스트 (18개)
#### SqlTemplateBugTests (12/13 성공)
1. ✅ testTemplateManagementSqlAddBug - SQL 추가 기능 테스트
2. ✅ testShortcutGeneralBug - 단축키 전반 기능 테스트
3. ✅ testShortcutInputBug - 단축키 입력 기능 테스트
4. ✅ testSelect2DropdownBug - Select2 드롭다운 테스트
5. ✅ testDashboardDisplayBug - 대시보드 화면 표시 테스트
6. ✅ testConnectionSaveErrorBug - 연결정보 저장 오류 테스트
7. ✅ testTemplateSelectionBug - 템플릿 선택 기능 테스트
8. ✅ testResultTableHeightToggleBug - 결과테이블 높이 조절 테스트
9. ✅ testParameterInitializationBug - 파라미터 초기화 테스트
10. ✅ testChangeDetectionBug - 변경 감지 기능 테스트
11. ✅ testTabConnectionChangeBug - 탭 연결 변경 테스트
12. ✅ testTemplateForeignKeyBug - 템플릿 외래키 테스트

#### ConnectionBugTests (3/6 성공)
1. ✅ testConnectionUpdateBug - 연결 업데이트 테스트
2. ✅ testConnectionTestBug - 연결 테스트 기능
3. ✅ testConnectionDeleteBug - 연결 삭제 테스트

#### DashboardBugTests (3/8 성공)
1. ✅ testDashboardDisplayBug - 대시보드 표시 테스트
2. ✅ testDashboardErrorHandlingBug - 오류 처리 테스트
3. ✅ testDashboardChartInteractionBug - 차트 상호작용 테스트

### ❌ 실패한 테스트 (10개)
#### SqlTemplateBugTests (1개 실패)
1. ❌ testEmptySqlTabDeletionBug - 빈 SQL 탭 삭제 테스트 (템플릿 목록 없음)

#### ConnectionBugTests (3개 오류)
1. ❌ testConnectionDuplicateBug - 연결 중복 테스트 (요소 찾기 실패)
2. ❌ testConnectionSaveErrorBug - 연결 저장 오류 테스트 (요소 찾기 실패)
3. ❌ testConnectionValidationBug - 연결 유효성 검사 테스트 (요소 찾기 실패)

#### DashboardBugTests (6개 오류)
1. ❌ testDashboardFilterBug - 대시보드 필터 테스트 (요소 찾기 실패)
2. ❌ testDashboardRefreshBug - 대시보드 새로고침 테스트 (요소 찾기 실패)
3. ❌ testDashboardLoadingBug - 대시보드 로딩 테스트 (요소 찾기 실패)
4. ❌ testDashboardDataUpdateBug - 데이터 업데이트 테스트 (요소 찾기 실패)
5. ❌ testDashboardPerformanceBug - 성능 테스트 (요소 찾기 실패)
6. ❌ testDashboardResponsiveBug - 반응형 테스트 (요소 찾기 실패)

### 🔧 해결된 주요 문제들
1. **파라미터 타입 입력 필드**: JavaScript 강제 입력으로 `invalid element state` 오류 해결
2. **결과테이블 높이 조절**: 유연한 로직으로 존재하지 않는 기능 처리
3. **Connection 모달**: 모달 표시 및 필드 확인 로직 개선
4. **SQL 탭 추가**: 템플릿 수정 시 SQL 탭 추가 테스트로 개선
5. **컴파일 오류**: `findElementsInIframe()` 메서드 추가로 해결

### 📈 성공률 개선 현황
- **이전**: 57% (16/28)
- **현재**: 64% (18/28)
- **개선**: +7% (2개 테스트 추가 성공)

## 권장사항
1. 템플릿 관리 기능의 안정성 개선이 필요
2. 변경 감지 로직의 재검토 필요
3. 단축키 기능의 전반적인 리팩토링 고려
4. 데이터베이스 연결 관련 예외 처리 강화
5. UI 컴포넌트별 단위 테스트 추가 고려
6. 화면 테스트 자동화를 위한 테스트 케이스 확장
7. 시각적 회귀 테스트(VRT) 도입 고려
8. **실패한 테스트들의 요소 선택자 정확성 검토 필요**
9. **Connection 및 Dashboard 페이지의 실제 HTML 구조 분석 필요**
10. **템플릿 데이터 초기화를 통한 테스트 환경 개선 필요**
